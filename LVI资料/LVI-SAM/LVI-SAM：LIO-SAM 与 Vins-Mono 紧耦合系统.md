## LVI-SAM: Tightly-coupled Lidar-Visual-Inertial Odometry via Smoothing and Mapping

代码开源：[https://github.com/TixiaoShan/LVI-SAM](https://link.zhihu.com/?target=https%3A//github.com/TixiaoShan/LVI-SAM)

## VIS(visual-inertial system) 初始化

基于优化方法的 VIS 在初始化需要求解高度非线性的问题，因此效果常常不佳。初始化的质量取决于两个因素：传感器的初始运动和 IMU 参数的准确性，IMU 参数包括缓慢变换的 bias 和 白噪声。Vins-Mono 初始化时，若传感器移动速度慢或匀速运动时，初始化往往会失败。主要原因在于加速度激励不够大，无法正确初始化尺度。

为了提高 VIS 系统初始化的鲁棒性，系统状态量和 IMU 的 bias 先用 LIS (lidar-inertial system) 初始化，再基于图像时间戳对状态量插值并与图像关键帧关联，作为 VIS 初始化的初值。图像关键帧间 IMU 的 bias 假设不变。

## 特征深度关联

![](https://pic1.zhimg.com/v2-42e9fb83c8bae84a9afd7eb6476bf5ec_b.jpg)

初始化完成后，基于 VIS 估计的相机位姿，将多帧激光投影至图像坐标系获得稠密的深度地图。视觉特征点与深度地图中的深度值关联的具体方法见上图，主要分为以下几个步骤：

1.  将深度点投影至以相机为中心的单位球体上，再降采样深度点使得其分布均匀，使用极坐标系表示深度值的位置，构建 2 维 K-D 树用于搜索。
2.  投影图像特征点至球平面，寻找最近 3 个点，球心和特征点组成的射线与这 3 个点在笛卡尔坐标系组成的平面相交，特征点的深度值赋值为该交点的深度值。
3.  检查关联结果：多帧激光堆叠可能导致深度模糊（如上图 b 图所示），即不同距离的点云投影结果在同一极坐标系区域，因此检查这 3 个最近的深度点之间的距离差异来拒绝这种情况。如果最大距离差异大于 2 米，则丢弃本次关联。

![](https://pic2.zhimg.com/v2-463db145defe7c3ac759f5452a016f15_b.jpg)

上图展示了两种场景下特征点与深度点的关联结果。（a，c）两图中颜色变化表示深度变化，（b，d）图中绿点表示成功关联的点，红点则反之。从左图场景中可发现，虽然深度值覆盖了大部分图像，但是由于验证失败，右上角有许多关联失败点。从右图场景中，可观察到近处两个较稳定的特征点没有成功建立关联。

综上实验观察，_运动前后很容易产生遮挡出现/消失的情况，将同一物体如车子的 3 维模型投影至极坐标系下容易出现深度模糊的情况，因此是否还有其他更合适的关联方法？_

## VIS 失效情况监测

在运动剧烈、光照变换、纹理少等情况，特征跟踪数量坠减，VIS 失效。此时，VIS 系统会错误估计 IMU 的 bias。因此当 VIS 系统跟踪的特征点过少，或 IMU bias 估计值超过某一阈值时，判定 VIS 系统失效。此时重新初始化 VIS 系统。

## 回环检测

图像 DBoW2。

## LIS

![](https://pic3.zhimg.com/v2-b40149f5e35b2de8288e466fc1808232_b.jpg)

LIS 中因子图包含 4 类约束：IMU 预积分约束项、视觉里程计约束项、关键帧与地图匹配得到的激光里程计约束、VIS 检测到回环 LIS 估计回环位姿得到的回环约束。

LIS 系统初始化前，假设系统静止不动。初始值的设置对 scan-to-map 匹配十分重要，作者通过关键帧至当前时刻 IMU 的位姿积分结果作为匹配的预测值。系统初始化误差后，基于因子图估计 IMU 的bias、系统位姿、速度。

系统初始化完成后，激光匹配的初始值有两个来源：IMU 积分值、VIS 里程计结果。作者优先使用后者。

## LIS 失效情况监测

参考 LOAM 中的方法，若在配准的第一次迭代求解方程 $AX=b$ 时，$A^TA$ 矩阵的最小特征值小于某一阈值，判定 LIS 系统失效。

## 实验

![](https://pic1.zhimg.com/v2-d02d7a00b0a3974ce572a9d8e7fb5620_b.jpg)

![](https://pic2.zhimg.com/v2-e752abdf7a6a5a13a4e62d4f7b86aa71_b.jpg)

在城市环境下手持步行采集数据，环境中有移动的汽车、走动的行人等。有时还将设备朝地看，在此严酷的情况下测试。

![](https://pic3.zhimg.com/v2-39def77d264f8edbdfa69d2236619956_b.jpg)

左图为车载情况下采集数据、右图为手持设备采集数据环境图。

![](https://pic4.zhimg.com/v2-c2307fd97fefa05461a5ee2b2578fee3_b.jpg)

![](https://pic3.zhimg.com/v2-eae7ef90c83f74eb2c4e13b6c0f486ea_b.jpg)

在车载情况下、手持设备下采集数据的定性、定量评估结果。