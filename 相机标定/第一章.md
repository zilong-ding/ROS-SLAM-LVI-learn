## 标定基础知识

### 相机内参

焦距f：相机中心到成像平面的距离

像素纵横比：非标准正方形像素变形的纵横比$\alpha$。

$f_x$: $f_x = m_uf$

$f_y$: $f_y=m_vf$

$m_u,m_v$分别表示一个像素的长宽的倒数

$(p_x,p_y)$为以图像左上角为原点的像素坐标系下像主点的坐标

s: skew  这个参数用来表示像素是平行四边形而不是矩形，这个参数同样可以认为是传感器的安置不严格与相机主光轴垂直造成的变形的近似，事实上 s与像素坐标系的X，Y轴之间的夹角 $\theta$ 的正切值$\tan\theta$ 成反比，因此当 $s=0$时，表示像素为矩形。

### 相机外参

表示相机相对于世界坐标的位置和姿态。

### 为什么要做相机标定

在拍照的过程中，从三维的场景到二维的图片，我们事实上损失了深度的信息，而当我们要从照片中得到深度信息是，便需要做相机的标定。相机标定，就是使用数学模型和数学方法来近似逼近这一复杂映射函数的过程。标定后的相机即具有了描述这一过程的能力，从而可以用于各种计算机视觉的任务，如深度恢复、三维重建等，本质上都是对丢失的距离信息的恢复。

![image-20220108235635536](https://github.com/zilong-ding/ROS-SLAM-LVI-learn/blob/main/Images/image-20220108235635536.png)

## 相机标定是在标什么

### 单目视觉应用

单帧测距、车载 ADAS 辅助、单目SLAM

这类应用，我们通常需要相机自身的成像模型参数以及相机相对某个坐标系下的相对位姿，即相机的内外参。

### 双目/多目/RGB-D组合

这类应用更加常见，我们需要获取相机自身信息，以及各个相机之间的相对位姿关系，有时也需要获取其和某固定坐标系之间的关系

## 相机标定基本流程

### 张正有标定操作步骤

> 1. 张正友标定方案使用平面标志物，通常是规整的棋盘格或者点阵图
> 2. 将标志物打印后，使用待标定相机拍摄不同角度多组标定图案
> 3. 使用标定工具进行标定计算

### 注意事项

> ​	1.拍摄数量通常为15~20张
>
> ​	2.标定图案需要保证平整
>
> ​	3.每张图片中标志物尽量占据画面1/4以上，不同标定板角度尽量存在一个相对明显的旋转和平
> 移——主要是为了角点检测
>
> ​	4.拍摄时应尽量保证相机参数不变：这里主要是焦距不变，焦距变化会导致部分fov变化，从而影响几乎全部的标定参数。当然，大多数场景中相机本身焦距都是固定的，而消费级，如手机镜头由于其本身畸变不大，且焦距较短，因此影响会比较小
>
> ​	5.保证拍摄图案清晰，无明显模糊
>
> ​	6.拍摄图案的总和需要覆盖整个画面：我们知道标定本身可以理解为一个拟合各个像素位置成像的过程，如果覆盖不完全，就会导致某些区域像素处于无约束状态，从而出现标定错误。我们常见的图片**去畸变后边缘扭曲**大多是该原因导致的。

## 常用标定工具使用

### Matlab标定工具箱

非常经典的一款标定工具箱，Calib Toolbox for Matlab（http://www.vision.caltech.edu/bouguetj/calib_doc/），其支持单相机、双相机的标定。

#### 单目标定

```matlab
cd '图片路径'
calib_gui
# 打开工具箱
# 点击标定工具窗口中的Image names 按钮。输入标定图像的基名和图像的格式,
# 使用Extract grid corners 提取角点

```

<img src="https://github.com/zilong-ding/ROS-SLAM-LVI-learn/blob/main/Images/image-20220109001557949.png" alt="image-20220109001557949" style="zoom:80%;" />

Image names: 输入图片名称和后缀

Read images：载入图片

Extract grid corners: 角点检测

Calibration: 标定

Show Extrinsic：显示标定板与相机之间的位置

reproject on images：可视化每张图的重投影误差

Recomp.corners：重新计算角点

Undistort image：将图片去畸变

Save：保存标定参数

#### 双目标定

> 1. 切换路径至 `stereo_example` ，输入命令 `stereo_gui`
> 2. 选择 `Load left and right calibration files` , 加载已经完成的单目标定结果
> 3. 直接选择标定`Run stereo calibration` 即可，会输出优化后各个相机参数以及对应的旋转和平移

<img src="https://github.com/zilong-ding/ROS-SLAM-LVI-learn/blob/main/Images/image-20220109002605409.png" alt="image-20220109002605409" style="zoom:80%;" />



